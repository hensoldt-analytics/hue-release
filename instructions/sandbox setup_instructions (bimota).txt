1) Setup HDP via ambari.
2) 
yum install git ant asciidoc cyrus-sasl-devel cyrus-sasl-gssapi gcc gcc-c++ krb5-devel libxml2-devel libxslt-devel mysql  mysql-devel openldap-devel python-devel python-simplejson sqlite-devel
useradd sandbox
su - sandbox
cd /home/sandbox
wget -O .ssh.tar.gz https://dl.dropbox.com/s/y4ae019z6944vn3/.ssh.tar.gz?dl=1
tar xvf .ssh.tar.gz
chmod 600 .ssh/id_rsa
rm .shh.tar.gz
wget http://mirrors.besplatnyeprogrammy.ru/apache/maven/maven-3/3.0.4/binaries/apache-maven-3.0.4-bin.tar.gz
tar xvf apache-maven-3.0.4-bin.tar.gz
rm apache-maven-3.0.4-bin.tar.gz
export PATH=$PATH:/home/sandbox/apache-maven-3.0.4/bin/
git clone git@bitbucket.org:qwerty_nor/sandbox.git hue
git clone git@github.com:hortonworks/sandbox-shared.git
git clone git@github.com:hortonworks/sandbox-tutorials.git
cd hue
make apps
cd desktop/conf
ln -s /home/sandbox/sandbox-shared/instructions/hue.ini

mysql -u root
> CREATE DATABASE sandbox;
> grant usage on *.* to sandbox@localhost identified by '1111';
> grant all privileges on sandbox.* to sandbox@localhost ;

cd /home/sandbox/hue/apps
rm -rf beeswax
rm -rf about
ln -s /home/sandbox/sandbox-shared/apps/beeswax
ln -s /home/sandbox/sandbox-shared/apps/pig
ln -s /home/sandbox/sandbox-shared/apps/about
ln -s /home/sandbox/sandbox-shared/apps/hcatalog

cd ../
build/env/bin/python tools/app_reg/app_reg.py --install apps/pig
build/env/bin/python tools/app_reg/app_reg.py --install apps/hcatalog

Ctrl+D to return to root user:
cd /home/sandbox/sandbox-shared/start_scripts
./stop.sh
cd /home/sandbox/hue
mv desktop/libs/hadoop/java-lib/hue-plugins-2.1.0-SNAPSHOT.jar /usr/lib/hadoop/lib/hue-plugins-2.1.0-SNAPSHOT.jar

2) edit /etc/hadoop/conf/core-site.xml:
a) change all hadoop.proxyuser.(service_name).host and hadoop.proxyuser.(service_name).group to *
b) add 
<property>
  <name>hadoop.proxyuser.hue.hosts</name>
  <value>*</value>
</property>
<property>
  <name>hadoop.proxyuser.hue.groups</name>
  <value>*</value>
</property>
to the end of the file
3) edit /etc/hadoop/conf/hdfs-site.xml:
a) Change dfs.block.access.token.enable to false
b) Change dfs.permissions to false
c) Change dfs.web.ugi to sandbox,sandbox
d) Change dfs.http.address to localhost:50070
e) Add dfs.support.broken.append to true
e) Add dfs.support.append to true

4) edit /etc/hadoop/conf/mapred-site.xml:

a) Set mapred.jobtracker.completeuserjobs.maximum to 1000
mapred.jobtracker.retirejob.interval to 86400000


b) Add

<property>
  <name>jobtracker.thrift.address</name>
  <value>0.0.0.0:9290</value>
</property>
<property>
  <name>mapreduce.jobtracker.plugins</name>
  <value>org.apache.hadoop.thriftfs.ThriftJobTrackerPlugin</value>
  <description>Comma-separated list of jobtracker plug-ins to be activated.</description>
</property>


5) edit /etc/oozie/conf/oozie-site.xml:

a) Add:
<property>
    <name>oozie.service.ProxyUserService.proxyuser.hue.hosts</name>
    <value>*</value>
</property>
<property>
    <name>oozie.service.ProxyUserService.proxyuser.hue.groups</name>
    <value>*</value>
</property>

6) edit /etc/hive/conf/hive-site.xml:

a) Change hive.security.authorization.enabled to false
b) Remove this property:
<property>
    <name>hive.security.authorization.manager</name>
    <value>org.apache.hcatalog.security.HdfsAuthorizationProvider</value>
    <description>the hive client authorization manager class name.
    The user defined authorization class should implement interface org.apache.hadoop.hive.ql.security.authorization.HiveAuthorizationProvider.  </description>
  </property>

7) yum install supervisor
8) edit /etc/supervisord.conf
Add:
[program:sandbox]
command=/home/sandbox/hue/build/env/bin/supervisor            ; the program (relative uses PATH, can take args)
;priority=999                ; the relative start priority (default 999)
autostart=true              ; start at supervisord start (default: true)
autorestart=true            ; retstart at unexpected quit (default: true)
;startsecs=10                ; number of secs prog must stay running (def. 10)
;startretries=3              ; max # of serial start failures (default 3)
;exitcodes=0,2               ; 'expected' exit codes for process (default 0,2)
;stopsignal=QUIT             ; signal used to kill process (default TERM)
;stopwaitsecs=10             ; max num secs to wait before SIGKILL (default 10)
user=sandbox                 ; setuid to this UNIX account to run the program
;log_stdout=true             ; if true, log program stdout (default true)
;log_stderr=true             ; if true, log program stderr (def false)
logfile=/home/sandbox/hue/logs/sandbox.log    ; child log path, use NONE for none; default AUTO
;logfile_maxbytes=1MB        ; max # logfile bytes b4 rotation (default 50MB)
;logfile_backups=10          ; # of logfile backups (default 10)

18) cd /home/sandbox/hue 
/etc/init.d/supervisord restart
